<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HackerNews Discussion Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold mb-8 text-gray-800">HackerNews Discussion Summarizer</h1>
        
        <div id="loading" class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
            <p class="mt-4 text-gray-600">Fetching and analyzing discussions...</p>
        </div>

        <div id="summaries" class="space-y-6"></div>
    </div>

    <script>
        // Configure marked.js to preserve the HTML we generate for citations
        marked.setOptions({
            headerIds: false,
            mangle: false
        });

        document.addEventListener('DOMContentLoaded', async () => {
            const loadingEl = document.getElementById('loading');
            const summariesEl = document.getElementById('summaries');

            try {
                const response = await fetch('/api/summaries');
                const summaries = await response.json();
                
                loadingEl.style.display = 'none';
                
                summaries.forEach(summary => {
                    const article = document.createElement('article');
                    article.className = 'bg-white rounded-lg shadow-md p-6';
                    
                    // Process the summary through marked for Markdown rendering
                    // while preserving our HTML citation links
                    const processedSummary = marked.parse(summary.summary);
                    
                    article.innerHTML = `
                        <h2 class="text-xl font-semibold mb-2">
                            <a href="${summary.url}" class="text-blue-600 hover:text-blue-800" target="_blank">
                                ${summary.title}
                            </a>
                        </h2>
                        <div class="text-sm text-gray-600 mb-4 flex gap-4">
                            <span>${summary.points} points</span>
                            <span>|</span>
                            <span>${summary.commentCount} comments</span>
                            <span>|</span>
                            <a href="https://news.ycombinator.com/item?id=${summary.story_id}" 
                               class="text-blue-600 hover:text-blue-800" 
                               target="_blank">
                                View on HN
                            </a>
                        </div>
                        <div class="prose max-w-none">
                            ${processedSummary}
                        </div>
                    `;
                    
                    // Apply additional styling to the rendered Markdown
                    const proseDiv = article.querySelector('.prose');
                    proseDiv.querySelectorAll('h1, h2, h3, h4').forEach(header => {
                        header.className = 'font-bold mt-4 mb-2';
                    });
                    proseDiv.querySelectorAll('ul, ol').forEach(list => {
                        list.className = 'my-2 ml-6';
                    });
                    proseDiv.querySelectorAll('li').forEach(item => {
                        item.className = 'my-1';
                    });
                    proseDiv.querySelectorAll('p').forEach(p => {
                        p.className = 'my-2';
                    });
                    
                    summariesEl.appendChild(article);
                });
            } catch (error) {
                loadingEl.innerHTML = `
                    <p class="text-red-600">Error loading summaries: ${error.message}</p>
                `;
            }
        });
    </script>
</body>
</html>
